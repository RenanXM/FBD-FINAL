-- FILEGROUP 1 arquivo
--Tabela de Playlists, Tabela de Faixas, Tabela de Associação Playlist_Faixa 


-- FILEGROUP 2 arquivos
--Tabela de Meios Físicos, Tabela de Álbuns, Tabela de Discos, 
--Tabela de Tipos de Composição, Tabela de Intérpretes, 
--Tabela de Compositores, Tabela de Períodos Musicais, Tabela de Gravadoras, 



-- Banco de dados BDSpotPer
USE master;
GO

-- Filegroup primário e o arquivo de dados primário
CREATE DATABASE BDSpotPer
ON PRIMARY
  (NAME = 'PrimaryFileGroup',
   FILENAME = 'C:\Path\To\PrimaryFile.mdf',
   SIZE = 100MB,
   MAXSIZE = UNLIMITED,
   FILEGROWTH = 10MB)
LOG ON
  (NAME = 'Log',
   FILENAME = 'C:\Path\To\LogFile.ldf',
   SIZE = 50MB,
   MAXSIZE = 100MB,
   FILEGROWTH = 10MB);

-- Adicionando o segundo filegroup com dois arquivos
ALTER DATABASE BDSpotPer
ADD FILEGROUP SecondFilegroup;

ALTER DATABASE BDSpotPer
ADD FILE
  (NAME = 'SecondFile1',
   FILENAME = 'C:\Path\To\SecondFile1.ndf',
   SIZE = 50MB,
   MAXSIZE = UNLIMITED,
   FILEGROWTH = 10MB),
  (NAME = 'SecondFile2',
   FILENAME = 'C:\Path\To\SecondFile2.ndf',
   SIZE = 50MB,
   MAXSIZE = UNLIMITED,
   FILEGROWTH = 10MB);

-- Adicionando o terceiro filegroup com um arquivo
ALTER DATABASE BDSpotPer
ADD FILEGROUP ThirdFilegroup;

ALTER DATABASE BDSpotPer
ADD FILE
  (NAME = 'ThirdFile1',
   FILENAME = 'C:\Path\To\ThirdFile1.ndf',
   SIZE = 100MB,
   MAXSIZE = UNLIMITED,
   FILEGROWTH = 20MB);

-- Alocando tabelas nos filegroups específicos
USE BDSpotPer;
GO

-- Tabelas alocadas no filegroup com um arquivo (ThirdFilegroup)
CREATE TABLE Playlist (
    ID_Playlist INT PRIMARY KEY,
    Codigo VARCHAR(255),
    Nome VARCHAR(255),
    DataCriacao DATE,
    TempoExecucaoTotal TIME
) ON ThirdFilegroup;

CREATE TABLE Faixa (
    ID_Faixa INT PRIMARY KEY,
    CodigoAlbum VARCHAR(255) REFERENCES Album(Codigo),
    NumeroFaixa INT,
    Descricao VARCHAR(255),
    TipoComposicao INT REFERENCES TipoComposicao(ID_TipoComposicao),
    Interpretes VARCHAR(255),
    Compositores VARCHAR(255),
    TempoExecucao TIME,
    TipoGravacao VARCHAR(50) CHECK (
        (TipoGravacao IN ('ADD', 'DDD') AND ID_MeioFisico = 1) OR -- CD
        (TipoGravacao IS NULL AND ID_MeioFisico IN (2, 3)) -- Vinil ou Download
    ),
    ID_TipoComposicao INT REFERENCES TipoComposicao(ID_TipoComposicao) NOT NULL
) ON ThirdFilegroup;

CREATE TABLE Playlist_Faixa (
    ID_Associacao INT PRIMARY KEY,
    ID_Playlist INT REFERENCES Playlist(ID_Playlist),
    ID_Faixa INT REFERENCES Faixa(ID_Faixa),
    DataUltimaVezTocada DATETIME,
    NumeroVezesTocada INT
) ON ThirdFilegroup;

-- Tabelas alocadas no filegroup com dois arquivos (SecondFilegroup)
CREATE TABLE MeioFisico (
    ID_MeioFisico INT PRIMARY KEY,
    Tipo VARCHAR(50)
) ON SecondFilegroup;

CREATE TABLE Album (
    ID_Album INT PRIMARY KEY,
    Codigo VARCHAR(255) UNIQUE,
    Descricao VARCHAR(500),
    ID_Gravadora INT REFERENCES Gravadora(ID_Gravadora),
    PrecoCompra DECIMAL(10,2) CHECK (PrecoCompra >= 0),
    DataCompra DATE CHECK (DataCompra > '2000-01-01'),
    DataGravacao DATE CHECK (DataGravacao > '2000-01-01'),
    TipoCompra VARCHAR(50),
    ID_MeioFisico INT REFERENCES MeioFisico(ID_MeioFisico)
) ON SecondFilegroup;

CREATE TABLE Disco (
    ID_Disco INT PRIMARY KEY,
    CodigoAlbum VARCHAR(255) REFERENCES Album(Codigo),
    NumeroDisco INT,
    OutrasInformacoes VARCHAR(255),
    ID_MeioFisico INT REFERENCES MeioFisico(ID_MeioFisico)
) ON SecondFilegroup;

CREATE TABLE TipoComposicao (
    ID_TipoComposicao INT PRIMARY KEY,
    Codigo VARCHAR(255),
    Descricao VARCHAR(255)
) ON SecondFilegroup;

ALTER TABLE TipoComposicao
ADD CONSTRAINT UQ_TipoComposicao UNIQUE (ID_TipoComposicao);

CREATE TABLE Interprete (
    ID_Interprete INT PRIMARY KEY,
    Codigo VARCHAR(255),
    Nome VARCHAR(255),
    Tipo VARCHAR(255)
) ON SecondFilegroup;

CREATE TABLE Compositor (
    ID_Compositor INT PRIMARY KEY,
    Nome VARCHAR(255),
    LocalNascimentoCidade VARCHAR(255),
    LocalNascimentoPais VARCHAR(255),
    DataNascimento DATE,
    DataMorte DATE,
    ID_PeriodoMusical INT REFERENCES PeriodoMusical(ID_PeriodoMusical) NOT NULL
) ON SecondFilegroup;

CREATE TABLE Faixa_Compositor_Interprete (
    ID_Faixa INT REFERENCES Faixa(ID_Faixa),
    ID_Compositor INT REFERENCES Compositor(ID_Compositor),
    ID_Interprete INT REFERENCES Interprete(ID_Interprete),
    PRIMARY KEY (ID_Faixa, ID_Compositor, ID_Interprete)
) ON SecondFilegroup;

CREATE TABLE PeriodoMusical (
    ID_PeriodoMusical INT PRIMARY KEY,
    Codigo VARCHAR(255),
    Descricao VARCHAR(255),
    IntervaloTempo VARCHAR(255)
) ON SecondFilegroup;

CREATE TABLE Gravadora (
    ID_Gravadora INT PRIMARY KEY,
    Codigo VARCHAR(255),
    Nome VARCHAR(255),
    Endereco VARCHAR(255),
    Telefones VARCHAR(255),
    HomePage VARCHAR(255)
) ON SecondFilegroup;
